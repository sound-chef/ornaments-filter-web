<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>필터 디버깅</title>
</head>

<body>
    <h1>필터 디버깅</h1>
    <button onclick="testDataLoading()">데이터 로딩 테스트</button>
    <button onclick="testFiltering()">필터링 테스트</button>
    <div id="output"></div>

    <script src="data-parser.js"></script>
    <script src="search-engine.js"></script>
    <script src="app.js"></script>

    <script>
        async function testDataLoading() {
            const output = document.getElementById('output');
            output.innerHTML = '<h2>데이터 로딩 테스트</h2>';

            try {
                console.log('데이터 로딩 시작...');
                const loaded = await window.dataParser.loadData();
                output.innerHTML += `<p>데이터 로딩 결과: ${loaded}</p>`;

                if (loaded) {
                    const allOrnaments = window.dataParser.getAllOrnaments();
                    output.innerHTML += `<p>전체 악상기호 개수: ${allOrnaments.length}</p>`;

                    // 카테고리별 통계
                    const categories = {};
                    allOrnaments.forEach(ornament => {
                        const category = ornament.categoryName;
                        categories[category] = (categories[category] || 0) + 1;
                    });

                    output.innerHTML += '<h3>카테고리별 통계:</h3>';
                    Object.entries(categories).forEach(([category, count]) => {
                        output.innerHTML += `<p>${category}: ${count}개</p>`;
                    });
                }
            } catch (error) {
                output.innerHTML += `<p style="color: red;">오류: ${error.message}</p>`;
                console.error('데이터 로딩 오류:', error);
            }
        }

        async function testFiltering() {
            const output = document.getElementById('output');
            output.innerHTML = '<h2>필터링 테스트</h2>';

            try {
                // 주법 필터 테스트
                const filters = {
                    instruments: [],
                    categories: ['주법_악상기호'],
                    types: []
                };

                console.log('필터 테스트:', filters);
                const results = window.dataParser.filterOrnaments(filters);
                output.innerHTML += `<p>주법 필터 결과: ${results.length}개</p>`;

                if (results.length > 0) {
                    output.innerHTML += '<h3>주법 필터 결과:</h3>';
                    results.slice(0, 5).forEach(ornament => {
                        output.innerHTML += `<p>${ornament.name} (${ornament.instrumentName})</p>`;
                    });
                }

                // 악기 필터 테스트
                const instrumentFilters = {
                    instruments: ['장구'],
                    categories: [],
                    types: []
                };

                const instrumentResults = window.dataParser.filterOrnaments(instrumentFilters);
                output.innerHTML += `<p>장구 필터 결과: ${instrumentResults.length}개</p>`;

            } catch (error) {
                output.innerHTML += `<p style="color: red;">필터링 오류: ${error.message}</p>`;
                console.error('필터링 오류:', error);
            }
        }
    </script>
</body>

</html>