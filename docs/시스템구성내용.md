# 한국 전통 음악 악상기호 필터링 시스템 요구사항 정의서

## 1. 프로젝트 개요

### 1.1 프로젝트명
한국 전통 음악 악상기호 필터링 웹 애플리케이션

### 1.2 목적
한국 전통 음악의 다양한 악상기호(시김새)를 효율적으로 검색하고 필터링할 수 있는 웹 애플리케이션 개발

### 1.3 대상 사용자
- 한국 전통 음악 연구자
- 전통 음악 교육자
- 전통 음악 연주자
- 음악학도

## 2. 기능 요구사항

### 2.1 핵심 기능

#### 2.1.1 Faceted Navigation (면적 네비게이션)
- **카테고리별 필터링**: 주법, 빠르기, 꾸밈음, 음높이, 음세기, 음표현, 표기
- **악기별 필터링**: 장구, 가야금, 대금, 아쟁, 피리, 해금, 당피리/세피리, 기타
- **타입별 필터링**: 앞꾸밈음, 뒷꾸밈음
- **다중 선택 지원**: 여러 필터를 동시에 적용 가능
- **필터 조합**: AND/OR 연산 지원

#### 2.1.2 Hierarchical Navigation (계층적 네비게이션)
- **3단계 계층 구조**:
  1. 악기 (Instrument)
  2. 카테고리 (Category) 
  3. 개별 악상기호 (Ornament)
- **드릴다운 탐색**: 상위 카테고리에서 하위 항목으로 점진적 탐색
- **브레드크럼 네비게이션**: 현재 위치 표시 및 이전 단계로 이동

#### 2.1.3 Korean-Aware Fuzzy Search (한국어 특화 퍼지 검색)
- **한글 검색 지원**: 한국어 악상기호명 검색
- **NFKD 정규화**: 조합형 문자 분해를 통한 정확한 매칭
- **초성 검색**: 초성만으로도 검색 가능 (예: "ㄱㄴㄷ" → "가야금")
- **Partial Ratio**: 슬라이딩 윈도우 기반 부분 매칭으로 긴 텍스트에서 짧은 검색어 지원
- **동적 임계값**: 검색어 길이에 따른 자동 임계값 조정
- **LRU 캐시**: 최근 200개 검색 결과 캐싱으로 성능 최적화
- **실시간 검색**: 300ms 디바운싱을 통한 즉시 반응
- **검색어 하이라이트**: 매칭된 부분 강조 표시

#### 2.1.4 반응형 웹 디자인
- **모바일 우선 설계**: 모바일 환경에서 최적화
- **적응형 레이아웃**: 화면 크기에 따른 동적 레이아웃 조정
- **터치 친화적 UI**: 모바일 터치 인터페이스 지원
- **크로스 브라우저 호환성**: 주요 브라우저 지원

### 2.2 데이터 구조

#### 2.2.1 XML 데이터 구조
```xml
<ornaments>
  <instrument id="1" name="가야금" korean="가야금">
    <category id="1" name="빠르기(한배)_악상기호" korean="빠르기(한배)_악상기호">
      <ornament>
        <id>1</id>
        <name>덧길이</name>
        <filename>6_덧길이.png</filename>
        <description>덧길이 시김새</description>
        <autoalign>false</autoalign>
        <rightColumnOnly>false</rightColumnOnly>
        <imagePath>/path/to/image.png</imagePath>
      </ornament>
    </category>
  </instrument>
</ornaments>
```

#### 2.2.2 지원 악기 (실제 구현)
- 장구 (Janggu) - 구음 카테고리
- 가야금 (Gayageum) - 주법, 빠르기(한배) 카테고리
- 대금 (Daegeum) - 부호, 장식음(꾸밈음), 빠르기(한배), 주법 카테고리
- 아쟁 (Ajaeng) - 주법, 빠르기(한배) 카테고리
- 피리 (Piri) - 주법, 빠르기(한배), 장식(꾸밈음), 음정(가락), 당피리:세피리 카테고리
- 해금 (Haegeum) - 주법, 빠르기(한배) 카테고리

#### 2.2.3 카테고리 분류 (실제 구현)
- **구음**: 장구의 구음 표현 (덩(떵), 기덕, 궁(쿵) 등)
- **주법**: 연주 기법 관련 악상기호 (식지, 모지, 장지, 튕김 등)
- **빠르기(한배)**: 템포 관련 악상기호 (늘임표, 쉼표, 덧길이 등)
- **부호**: 대금의 특수 부호 (연음, 노, 니, 로, 리 등)
- **장식음(꾸밈음)**: 대금의 장식음 (니레, 니나, 니로 등)
- **장식(꾸밈음)**: 피리의 장식음 (니레표, 니라표 등)
- **음정(가락)**: 피리의 음정 관련 (로표, 니표, 느라표 등)
- **당피리:세피리**: 피리의 특수 카테고리

### 2.3 사용자 인터페이스

#### 2.3.1 레이아웃 구조
```
┌─────────────────────────────────────────┐
│ [Setting] [Articulation] [Global]      │
├─────────────────────────────────────────┤
│ 🔍 [검색창] Place Holder                 │
├─────────────────────────────────────────┤
│ Name                                    │
│ [아이콘] 북편과 채편을 동시 연주한다.     │
├─────────────────────────────────────────┤
│ Categories ▼                            │
│ [주법] [빠르기(한배)] [꾸밈음] [음높이]   │
│ [음세기] [음표현] [표기]                 │
├─────────────────────────────────────────┤
│ Instruments ▼                           │
│ [장구] [대금] [아쟁] [피리] [해금]       │
│ [가야금] [거문고] [당피리,세피리] [기타] │
├─────────────────────────────────────────┤
│ Type ▼                                  │
│ [앞꾸밈음] [뒷꾸밈음]                    │
├─────────────────────────────────────────┤
│ Result (146) ▼                          │
│ [덩(떵)] [기덕] [쿵] [작은 덩]          │
│ [더러러러] [버튼2] [버튼2] [버튼2]      │
└─────────────────────────────────────────┘
```

#### 2.3.2 UI 컴포넌트
- **탭 네비게이션**: Setting, Articulation, Global
- **검색 바**: 돋보기 아이콘과 플레이스홀더 텍스트
- **필터 섹션**: 접을 수 있는 섹션 헤더 (▼ 아이콘)
- **필터 버튼**: 둥근 모서리 버튼 그리드
- **결과 그리드**: 스크롤 가능한 결과 목록
- **스크롤바**: 세로 스크롤바

### 2.4 기술 요구사항

#### 2.4.1 프론트엔드 (실제 구현)
- **HTML5**: 시맨틱 마크업
- **CSS3**: Flexbox/Grid 레이아웃, 반응형 디자인
- **JavaScript (ES6+)**: 모던 자바스크립트
- **XML 파싱**: UTF-8 인코딩 지원 XML 데이터 처리
- **로컬 스토리지**: 검색 히스토리 및 사용자 설정 저장
- **VST 브리지**: VST 플러그인과의 양방향 통신
- **한국어 특화 검색**: NFKD 정규화, 초성 인덱싱, Partial Ratio

#### 2.4.2 성능 요구사항 (실제 구현)
- **초기 로딩 시간**: 1초 이내 (190개 악상기호 기준)
- **검색 응답 시간**: 50ms 이내 (LRU 캐시 활용)
- **메모리 사용량**: 2MB 이하 (190개 악상기호 기준)
- **이미지 최적화**: PNG 형식, 지연 로딩
- **캐싱**: LRU 캐시 (최근 200개 검색 결과), 브라우저 캐싱 활용
- **디바운싱**: 300ms 디바운싱을 통한 실시간 검색

#### 2.4.3 접근성
- **키보드 네비게이션**: Tab 키를 통한 탐색
- **스크린 리더 지원**: ARIA 라벨 및 시맨틱 HTML
- **고대비 모드**: 색상 대비 4.5:1 이상
- **폰트 크기 조절**: 사용자 정의 폰트 크기

## 3. 비기능 요구사항

### 3.1 성능 (실제 구현)
- **동시 사용자**: 클라이언트 측 애플리케이션으로 무제한 지원
- **데이터 처리**: 190개 악상기호 지원 (실제 데이터)
- **메모리 사용량**: 2MB 이하 (실제 측정값)
- **네트워크 대역폭**: 로컬 파일 시스템 기반으로 네트워크 불필요
- **VST 통합**: 실시간 양방향 통신 지원

### 3.2 보안
- **XSS 방지**: 입력 데이터 검증 및 이스케이핑
- **CSRF 방지**: 토큰 기반 보안
- **데이터 무결성**: XML 데이터 검증

### 3.3 호환성
- **브라우저 지원**: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+
- **모바일 지원**: iOS 12+, Android 8+
- **해상도 지원**: 320px ~ 1920px

## 4. 개발 환경

### 4.1 로컬 개발 환경 (실제 구현)
- **웹 서버**: 정적 파일 서빙 (Live Server)
- **개발 서버**: Live Server 또는 Python HTTP 서버
- **빌드 도구**: 없음 (Vanilla JavaScript)
- **패키지 관리**: 없음 (의존성 없는 순수 웹 애플리케이션)
- **데이터 생성**: Python 스크립트 (generate_xml.py)

### 4.2 배포 환경 (실제 구현)
- **VST 통합**: VST 플러그인 내 WebView로 임베드
- **정적 호스팅**: 로컬 파일 시스템 기반
- **CDN**: 불필요 (로컬 리소스 사용)
- **도메인**: VST 플러그인 내부 사용

## 5. 데이터 구조 상세

### 5.1 XML 스키마
```xml
<?xml version="1.0" encoding="UTF-8"?>
<ornaments>
  <instrument id="[숫자]" name="[영문명]" korean="[한글명]">
    <category id="[숫자]" name="[영문명]" korean="[한글명]">
      <ornament>
        <id>[고유ID]</id>
        <name>[악상기호명]</name>
        <filename>[파일명]</filename>
        <description>[설명]</description>
        <autoalign>[boolean]</autoalign>
        <rightColumnOnly>[boolean]</rightColumnOnly>
        <imagePath>[이미지경로]</imagePath>
      </ornament>
    </category>
  </instrument>
</ornaments>
```

### 5.2 이미지 리소스 (실제 구현)
- **경로**: `Resources/Ornaments/[악기번호]_[악기명]/[카테고리번호]_[카테고리명]/[파일번호]_[파일명].png`
- **형식**: PNG (투명 배경 지원)
- **크기**: 가변 크기 (실제 이미지 크기 유지)
- **최적화**: PNG 형식 유지 (WebP 변환 없음)
- **총 개수**: 190개 PNG 파일

## 6. 사용자 경험 (UX)

### 6.1 검색 경험 (실제 구현)
- **즉시 피드백**: 300ms 디바운싱을 통한 실시간 결과 표시
- **검색 제안**: 자동완성 기능 (검색 히스토리 기반)
- **검색 히스토리**: 로컬 스토리지를 통한 최근 검색어 저장
- **검색 결과 하이라이트**: 매칭된 텍스트 강조 표시
- **초성 검색**: 초성만으로도 검색 가능 (예: "ㄱㄴㄷ" → "가야금")
- **한국어 특화**: NFKD 정규화를 통한 정확한 한글 매칭

### 6.2 필터링 경험
- **시각적 피드백**: 선택된 필터 강조 표시
- **필터 조합 표시**: 현재 적용된 필터 목록
- **필터 초기화**: 전체 필터 리셋 기능
- **결과 개수 표시**: 필터링된 결과 수 표시

### 6.3 네비게이션 경험
- **직관적 탐색**: 계층적 구조를 통한 자연스러운 탐색
- **빠른 접근**: 자주 사용하는 악상기호 빠른 접근
- **컨텍스트 유지**: 현재 위치 및 탐색 경로 표시

## 7. 품질 보증

### 7.1 테스트 요구사항
- **단위 테스트**: JavaScript 함수별 테스트
- **통합 테스트**: API 및 데이터 처리 테스트
- **사용자 테스트**: 실제 사용자 대상 테스트
- **성능 테스트**: 로딩 시간 및 응답 시간 테스트

### 7.2 코드 품질
- **코드 리뷰**: 모든 코드 변경사항 리뷰
- **문서화**: API 및 함수 문서화
- **코드 스타일**: 일관된 코딩 스타일 유지
- **에러 처리**: 적절한 에러 핸들링

## 8. 배포 및 유지보수

### 8.1 배포 전략
- **스테이징 환경**: 배포 전 테스트 환경
- **점진적 배포**: 단계적 배포를 통한 위험 최소화
- **롤백 계획**: 문제 발생 시 이전 버전으로 복구

### 8.2 모니터링
- **성능 모니터링**: 응답 시간 및 오류율 추적
- **사용자 분석**: 사용 패턴 및 인기 검색어 분석
- **에러 로깅**: 시스템 오류 추적 및 알림

### 8.3 업데이트 계획
- **정기 업데이트**: 월간 기능 업데이트
- **데이터 업데이트**: 새로운 악상기호 추가
- **보안 패치**: 보안 취약점 수정
- **사용자 피드백**: 사용자 요청사항 반영